---
image: winston/room101-ci

script: |
  set -e -x

  pushd winston/
    export WINSTON_SHA=$(git rev-parse HEAD)
  popd

  pushd redgreen/
    export REDGREEN_SHA=$(git rev-parse HEAD)
  popd

  pushd prole/
    export PROLE_SHA=$(git rev-parse HEAD)
  popd

  pushd warden-linux/
    export WARDEN_LINUX_SHA=$(git rev-parse HEAD)
  popd

  cd room101/

  git submodule update --remote

  pushd src/winston/
    git checkout $WINSTON_SHA
  popd

  pushd src/redgreen/
    git checkout $REDGREEN_SHA
  popd

  pushd src/prole/
    git checkout $PROLE_SHA
  popd

  pushd src/warden-linux/
    git checkout $WARDEN_LINUX_SHA
  popd

  pushd src/redis/
    git fetch --tags
    git checkout 2.8.11
  popd

  git add src/

  git config --global user.email "ci@localhost"
  git config --global user.name "CI Bot"

  git commit -m "auto-bump"

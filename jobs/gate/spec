---
name: gate

description: |
  Gate registers a Garden worker with the ATC on an interval.

templates:
  gate_ctl.erb: bin/gate_ctl

packages:
  - pid_utils
  - gate

  # colocate base resources
  - archive_resource
  - cf_resource
  - docker_image_resource
  - git_resource
  - github_release_resource
  - s3_resource
  - semver_resource
  - time_resource
  - tracker_resource
  - vagrant_cloud_resource
  - bosh_io_release_resource
  - bosh_io_stemcell_resource

properties:
  gate.heartbeat_interval:
    description: "interval on which to register with the ATC"
    default: 30s

  gate.garden.address:
    description: "garden server connection address"

  gate.resource_types:
    description: "resource types supported by the worker, in [{type: type, image: image}] form"
    default:
      - type: archive
        image: /var/vcap/packages/archive_resource
      - type: cf
        image: /var/vcap/packages/cf_resource
      - type: docker-image
        image: /var/vcap/packages/docker_image_resource
      - type: git
        image: /var/vcap/packages/git_resource
      - type: s3
        image: /var/vcap/packages/s3_resource
      - type: semver
        image: /var/vcap/packages/semver_resource
      - type: time
        image: /var/vcap/packages/time_resource
      - type: tracker
        image: /var/vcap/packages/tracker_resource
      - type: vagrant-cloud
        image: /var/vcap/packages/vagrant_cloud_resource
      - type: github-release
        image: /var/vcap/packages/github_release_resource
      - type: bosh-io-release
        image: /var/vcap/packages/bosh_io_release_resource
      - type: bosh-io-stemcell
        image: /var/vcap/packages/bosh_io_stemcell_resource

  gate.platform:
    description: "platform of the worker to advertise"
    default: linux

  gate.tags:
    description: "an array of tags to advertise for the worker"
    default: []

  gate.atc.address:
    description: "atc server connection address"
    default: atc.service.dc1.consul:8080

  gate.atc.username:
    description: "ATC API basic auth username"
    default: ''

  gate.atc.password:
    description: "ATC API basic auth password"
    default: ''

  blackbox.syslog.sources.gate:
    description: "files whose contents blackbox will emit to its syslog drain"
    default:
      - /var/vcap/sys/log/gate/gate.stdout.log
      - /var/vcap/sys/log/gate/gate.stderr.log

  blackbox.syslog.sources.garden:
    description: "files whose contents blackbox will emit to its syslog drain"
    default:
      - /var/vcap/sys/log/garden/garden.stdout.log
      - /var/vcap/sys/log/garden/garden.stderr.log
      - /var/vcap/sys/log/monit/garden_ctl.log
      - /var/vcap/sys/log/monit/garden_ctl.err.log
